(()=>{"use strict";const e=e=>void 0!==e;function t(e){return"object"==typeof e&&null!==e}let r=function(e){return e.Init="init",e.Params="params",e.ReachGoal="reachGoal",e.Hit="hit",e}({});class s{static visitParams(e,t,s){const n=`yaCounter${e}`,o=n in window?window[n]:window.Ya?._metrika?.counters?.[`${e}:0`];window.Ya?.Metrika&&o instanceof window.Ya.Metrika||!window.ym&&window.Ya?.Metrika2&&o instanceof window.Ya.Metrika2?o.params(t):window.ym&&(s?ym(e,r.Params,t,s):ym(e,r.Params,t))}static reachGoal(e,t,s){"undefined"!=typeof ym&&(s?ym(e,r.ReachGoal,t,s):ym(e,r.ReachGoal,t))}static hit(e,t,s){ym(e,r.Hit,t,s)}static getCounters(){const r=Ya._metrika.getCounters();return Array.isArray(r)?r.map((e=>{if(t(e)&&"number"==typeof e.id){const t=Number(e.type);return{id:e.id,type:isNaN(t)?void 0:t,accurateTrackBounce:!!e.accurateTrackBounce,clickmap:!!e.clickmap,trackHash:!!e.trackHash,trackLinks:!!e.trackLinks,webvisor:!!e.webvisor}}})).filter(e):[]}static getZeroCodeConversionMarkup(){let e;const t=window.Ya._metrika.ecmv;if(t){e=s.getCounters().reduce(((e,r)=>{const s=t[`${r.id}:0`];return s&&(e[r.id]=JSON.parse(s)),e}),{})}return e}}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function i(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let c=function(e){return e.Observer="Observer",e.Factor="Factor",e.Revenue="Revenue",e.Global="Global",e.EventsBus="EventsBus",e.Storage="Storage",e.Mutex="Mutex",e}({});class a{getDeprecatedResult(e){return Object.entries(e).reduce(((e,[t,r])=>{const s=t;return e[s]={factors:[]},r.forEach((t=>{e[s].factors.push(t.factorId),void 0!==t.revenue&&(e[s].revenue={...e[s].revenue,[t.revenueId||t.factorId]:t.revenue})})),e}),{})}getResult(e,t=!0){return Object.entries(e).reduce(((e,[r,s])=>{const n=r;return e[n]={},s.forEach((r=>{const s=t&&r.internalData?Object.entries(r.internalData).reduce(((e,[t,r])=>(e[t]=r?.slice(0,Math.min(r.length,200)),e)),{}):void 0;e[n][r.factorId]={...s,revenue:r.revenue}})),e}),{})}}let l=function(e){return e.Development="development",e.Testing="testing",e.Preprod="preprod",e.Production="production",e}({});function u(){return l.Production}function d(e){const t=u();return`${e}${t!==l.Production?t[0]:""}`}const h=e=>{let t;return t="string"!=typeof e?JSON.stringify(e,void 0,2):e,t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,(function(e){let t="";return/^"/.test(e)?/:$/.test(e):/true|false/.test(e)?t="true"===e?"[32m":"[31m":/null/.test(e),`${t}${e}[39m`}))};class p extends a{sendZCData(e){console.log(h(this.getResult(e)))}log(e,...t){console.log(e,...t)}sendData(e){console.log(h(this.getResult(e)))}sendError(e,t,r){console.error({error:e,scope:t,context:r})}}class m extends a{sendZCData(e){this.send(this.getResult(e),"zc")}sendData(e){try{this.send(this.getResult(e),"ec2"),this.send(this.getDeprecatedResult(e))}catch(e){this.sendError(e,c.Global,"SEND")}}log(e,...t){}sendError(e,t,r){try{let s;const n=Array.isArray(r)?r:[r];s=e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:{name:"Unknown error",message:String(e)},this.send({[d("error")]:{...s,scope:t,context:n}})}catch(e){}}send(e,t="ec"){s.getCounters().map((r=>{try{s.visitParams(r.id,{__ym:{[d(t)]:e}})}catch(e){}}))}}let f;function v(){const e=u();try{return f||(f=e===l.Development?new p:new m),f}catch(e){}}const g=/matrix\((?:\d+,\s*){4}(-?\d+),\s*(-?\d+)\s*\)/;class w{constructor(){i(this,"id",void 0),i(this,"scope",void 0),i(this,"findElementsByPatterns",((e,t=1e4,r=document.body)=>{const s=[],n=[],o=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:r=>{try{const n=r.nodeValue?.toLowerCase().trim();if(!n||n.length>t)return NodeFilter.FILTER_SKIP;const o=this.matchSome(n,e);if(o)return s.push(o),NodeFilter.FILTER_ACCEPT}catch(e){this.sendError(e,["TREE_WALKER"])}return NodeFilter.FILTER_SKIP}});for(;o.nextNode();){const e=o.currentNode.parentElement,t=s.shift();e&&"SCRIPT"!==e.tagName&&t&&n.push({node:e,match:t})}return n}))}static getNodeAttrsAndText(e){return{convBtnCls:e.className,convBtnId:e.id,convBtnText:e.innerText?.trim()?.toLowerCase()??""}}log(e,...t){v()?.log(e,...t)}sendError(e,t){v()?.sendError(e,this.scope,t)}hasStopPhrases(e,{match:t,index:r},{before:s,after:n,inMatched:o,contextLength:i}){if(o&&this.matchSome(t,{keywords:o}))return!0;if(s){const t=i?Math.max(r-i,0):0,n=e.slice(t,r).trim();if(this.matchSome(n,{keywords:s}))return!0}if(n){const s=e.slice(r+t.length,i?i+r+t.length:void 0).trim();if(this.matchSome(s,{keywords:n}))return!0}return!1}matchSome(e,t){const r=this.match(e,t);return r?r[0]:void 0}match(e,t,r=!1){const s=[],n=e.toLowerCase().trim();for(const e of t.keywords){if(e instanceof RegExp)for(const o of n.matchAll(e)){const e={match:o[0].trim(),index:o.index};if(!(t.stopPhrases&&this.hasStopPhrases(n,e,t.stopPhrases)||(s.push(e),r)))break}else{const r=n.indexOf(e);if(-1!==r){const o={match:e,index:r};t.stopPhrases&&this.hasStopPhrases(n,o,t.stopPhrases)||s.push(o)}}if(s.length>=1&&!r)break}return s.length?s.map((e=>({phrase:e.match,phraseContext:n.length<100?n:n.slice(e.index,e.index+100).trim()}))):void 0}collectAttrs(e,t=5){let r=1,s=e;const n={ids:[],classNames:[]};for(;s&&r<=t;)n.ids.push(s.id),n.classNames.push(s.className),s=s.parentElement,r++;return n}checkVisibility(e,t=void 0,r=13){let s=1,n=e;const o={display:"none",visibility:"hidden",opacity:0,...t};for(;s<r&&n;){if("script"===n.tagName?.toLowerCase())return!1;const e=window.getComputedStyle(n);if(Object.entries(o).some((([t,r])=>"number"==typeof r?parseFloat(e?.[t])===r:e?.[t]===r)))return!1;if("fixed"===e.position){if("-"===e.left?.[0]||"-"===e.right?.[0])return!1;const t=e.right?.match(/(\d+)%?/),r=t?.[1]?parseInt(t[1],10):0,s="%"===e.right?.[e.right?.length-1];if(r>=100&&s||r>=1e3)return!1;const n=e.transform?.match(g),o=n?.[1]?parseInt(n[1],10):0,i=n?.[2]?parseInt(n[2],10):0;if(o<0||i<0)return!1}s++,n=n.parentElement}return!0}}class y extends w{constructor(...e){super(...e),i(this,"scope",c.Factor),i(this,"convCount",0),i(this,"lastMatchTimestamp",void 0)}apply(e){if(this.convCount&&this.lastMatchTimestamp){const e=Date.now()-this.lastMatchTimestamp;if(e>6e4)this.convCount=0;else if(e<1e3||this.convCount>10)return{isMatched:!1}}const t=this.applyFactor(e),r="boolean"==typeof t?{isMatched:t}:t;return r.isMatched&&(this.convCount++,this.lastMatchTimestamp=Date.now()),r}}class b extends y{constructor(e){super(),this.selectors=e}applyFactor(e){const t=e.target;if(t instanceof HTMLElement){const e=this.selectors.flatMap((e=>[e,`${e} *`])).some((e=>t.matches(e)));return{isMatched:e,internalData:e?y.getNodeAttrsAndText(t):void 0}}return!1}}class k extends b{constructor(){super(["#bx-soa-orderSave a",".btn-order-save"]),i(this,"id","1c-bitrix-click")}}class C extends w{constructor(...e){super(...e),i(this,"scope",c.Revenue)}parsePrice(t){if(!t.length)return;const r=t.map((e=>{const t=e.textContent?(e=>{if(!e)return;const t=e.match(/[\d.,\s]+/)?.[0]?.replace(/\s/g,"");if(!t)return;const r=t.includes(","),s=t.includes(".");if(r&&s)return t.lastIndexOf(",")>t.lastIndexOf(".")?parseFloat(t.replace(/\./g,"").replace(",",".")):parseFloat(t.replace(/,/g,""));return r?parseFloat(t.replace(",",".")):parseFloat(t)})(e.textContent):void 0;if(t)return{matchedNode:e,revenue:t}})).filter(e).sort(((e,t)=>e.revenue-t.revenue)),s=r[r.length-1];return r.length?{revenue:s.revenue,matchedNode:s.matchedNode,internalData:{"raw-revenue":t.map((e=>e.textContent?.slice(50))).filter(e).slice(0,2).join(",")}}:void 0}}class E extends C{constructor(e){super(),this.selectors=e}apply(){const e=this.selectors.flatMap((e=>[...document.querySelectorAll(e)])),t=this.parsePrice(e);return t?((e,t)=>{const r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!t.includes(s)&&(r[s]=e[s]);return r})({...t},["matchedNode"]):t}}class x extends E{constructor(){super([".bx-soa-cart-total-line-total .bx-soa-cart-d"]),i(this,"id","1c-bitrix-click-parsed-revenue")}}class S extends b{constructor(){super([".litecheckout__submit-btn",'[name="dispatch[checkout.place_order]"]',"#litecheckout_place_order"]),i(this,"id","cs-cart-click")}}class _ extends E{constructor(){super([".ty-checkout-summary__total-sum"]),i(this,"id","cs-cart-click-parsed-revenue")}}class T extends b{constructor(){super([".co-button--checkout","#create_order"]),i(this,"id","insales-click")}}class P extends E{constructor(){super([".co-basket_total-price"]),i(this,"id","insales-click-parsed-revenue")}}class R extends b{constructor(){super(['[name="finish_registration"]','[value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑"]',".nevigen-onestepcheckout-finish button",".button_order_finish","#button_order_finish","#cart-button-finish"]),i(this,"id","joomla-click")}}class L extends E{constructor(){super([".jshop_subtotal .total .value","#total_cart .total .value",".totalvalue"]),i(this,"id","joomla-click-parsed-revenue")}}class O extends b{constructor(){super([".shop2-btn"]),i(this,"id","megagroup-click")}}class M extends E{constructor(){super([".cart-total__item.last_item .cart-total__body"]),i(this,"id","megagroup-click-parsed-revenue")}}class N extends b{constructor(){super(["#simplecheckout_button_confirm",'[data-onclick="createOrder"]',"#button-confirm","#confirm_checkout","#button_checkout","#button-go"]),i(this,"id","opencart-click")}}class I extends E{constructor(){super(["#total_total .simplecheckout-cart-total-value","#unicheckout .total","#total_total"]),i(this,"id","opencart-parsed-revenue-selector-data-collector")}}class D extends b{constructor(){super(['[class*="cartpage-form"] .t-submit','[class*="orderform"] .t-submit']),i(this,"id","tilda-click")}}const A=['[class*="cartwin-totalamount-content"] [class*="cartwin-prodamount-price"]'];class F extends E{constructor(){super(A),i(this,"id","tilda-parsed-revenue-selector-data-collector")}}class $ extends y{constructor(...e){super(...e),i(this,"buttonSelector",'[class*="btn"], [class*="submit"], [class*="button"], [class*="confirm"], [id*="btn"], [id*="submit"], [id*="button"], [id*="confirm"], a, button, [type="submit"], [name="submit"]'),i(this,"blockClasses",["buttons"]),i(this,"keywords",[/(:?–∑–∞–≤–µ—Ä—à–∏—Ç—å|–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å)[\p{P}\s]*(\s–∏\s)*(:?$|–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ|–∑–∞–∫–∞–∑|–æ—Ç–ø—Ä–∞–≤–∏—Ç—å|–ø–æ–∫—É–ø–∫—É)/gu,/–æ—Ç–ø—Ä–∞–≤–∏—Ç—å[\p{P}\s]*(:?$|–∑–∞–∫–∞–∑|–∑–∞—è–≤–∫—É)/gu,/(?<!\p{L})(:?—Å–¥–µ–ª–∞—Ç—å|—Å–æ–∑–¥–∞—Ç—å|—Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å|–æ—Å—Ç–∞–≤–∏—Ç—å)[\p{P}\s]+–∑–∞–∫–∞–∑/gu,/–æ—Ñ–æ—Ä–º(:?–∏—Ç—å|–ª—è—é|–ª—è–µ–º)|–∑–∞–∫–∞–∑–∞—Ç—å|–æ–ø–ª–∞—Ç–∏—Ç—å|–∫ –æ–ø–ª–∞—Ç–µ|–∑–∞–ø–∏—Å–∞—Ç—å—Å—è|–∫—É–ø–∏—Ç—å –±—ã—Å—Ç—Ä–æ|–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å/gu]),i(this,"contentPatterns",{keywords:this.keywords,stopPhrases:{before:[/(?<!\p{L})(?:–∫–∞–∫|–º–æ–∂–Ω–æ|–º–æ–∂–µ–º|—á—Ç–æ–±—ã|–ø–æ—á–µ–º—É|–∫–æ–¥)(?!\p{L})/gu],after:[/(?<!\p{L})–≤–æ–∑–≤—Ä–∞—Ç|–∑–≤–æ–Ω–æ–∫(?!\p{L})/gu],contextLength:30}}),i(this,"id","universal-conversion-collector"),i(this,"checkContent",(e=>{const t=e?.innerText?.trim().toLowerCase(),r=e?.getAttribute("value")?.trim().toLowerCase();let s;return t&&t.length<=50&&(s=this.matchSome(t,this.contentPatterns)),!s&&r&&(s=this.matchSome(r,this.contentPatterns)),!!s}))}applyFactor(e){if(!(e.target instanceof HTMLElement))return!1;let t=e.target,r=!1;for(let e=1;e<=2&&t;e++)if(t=t.closest(this.buttonSelector),t&&!this.matchSome(t.className||"",{keywords:this.blockClasses})){if(r=this.checkContent(t),r)break;t=t.parentElement}return{isMatched:r,internalData:r&&t?y.getNodeAttrsAndText(t):void 0}}}class B extends ${constructor(...e){super(...e),i(this,"keywords",[/(?:–∑–∞–∫–∞–∑–∞—Ç—å|–æ–±—Ä–∞—Ç–Ω—ã–π)\s+–∑–≤–æ–Ω–æ–∫/gu,/–æ—Ç–ø—Ä–∞–≤–∏—Ç—å\s+–∑–∞–ø—Ä–æ—Å/gu,/(?<!\p{L})–æ—Å—Ç–∞–≤–∏—Ç—å\s+(?:–∑–∞–ø—Ä–æ—Å|–∑–∞—è–≤–∫—É)/gu]),i(this,"contentPatterns",{keywords:this.keywords,stopPhrases:{before:[/(?<!\p{L})(?:–∫–∞–∫|–º–æ–∂–Ω–æ|—á—Ç–æ–±—ã)(?!\p{L})/gu],contextLength:30}}),i(this,"id","universal-lead-collector")}}class K extends C{constructor(...e){super(...e),i(this,"id","universal-revenue-collector"),i(this,"selector",'[class*="total"]:not([class*="totals"]), [class*="sum"]'),i(this,"keywords",[/(?<!\p{L})–∏—Ç–æ–≥/giu]),i(this,"lowPriorityKeywords",["–≤—Å–µ–≥–æ:",/(?<!–º–∏–Ω–∏–º–∞–ª—å–Ω\S\S\s)—Å—É–º–º/gi,"–∫ –æ–ø–ª–∞—Ç–µ","—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤","–æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å"]),i(this,"revenueRegExp",/\b(\d+(?:[.,\s]\d{3})*)(?:[.,]\d{1,2}(?!\d))?/g),i(this,"blackList",[/–Ω–¥—Å[ \p{P}]*$/iu,/(.)(–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π\s+–∑–∞–∫–∞–∑|–º–∏–Ω\.?\s*–∑–∞–∫–∞–∑)\s*[:;.,!?-]*\s*$/i,/—Ä–∞–∑–º–µ—Ä[ \p{P}]*$/iu,/–¥–æ—Å—Ç–∞–≤–∫\S[ \p{P}]*$/iu]),i(this,"parseRevenue",(e=>{let t;const r=[];for(;null!==(t=this.revenueRegExp.exec(e));){const s=e.substring(0,t.index);if(this.blackList.some((e=>e.test(s.toLowerCase().trim())))){this.log("BLACKLIST MATCHED",s.toLowerCase().trim());continue}const n=Number.parseFloat(t[1].replace(/[.,\s]/g,""));n>=99&&n<=999999&&r.push(n)}return r}))}apply(e){const t=[];for(const e of this.findElementsByPatterns({keywords:this.keywords},50)){this.findRevenue(e.node).items.length&&t.push(this.findRevenue(e.node))}let r=this.getRelevantValue(t);if(r)return this.log("HIGH PRIORITY VERDICT",r),r;for(const e of this.findElementsByPatterns({keywords:this.lowPriorityKeywords},50)){this.findRevenue(e.node).items.length&&t.push(this.findRevenue(e.node))}return t.length&&this.log("low priority results",t),t&&0!==t.length&&(r=this.getRelevantValue(t,!0)),r&&this.log("LOW PRIORITY VERDICT",r),r}getRelevantValue(e,t=!1){let r=e.filter((e=>e.isSelectorMatched&&1===e.items.length));return r.length?Math.min(...r.flatMap((e=>e.items))):t?(r=e.filter((e=>e.items.length)).sort(((e,t)=>{const r=e.items.length-t.items.length;return 0===r?e.isSelectorMatched?1:-1:r})),r[0]?.items.length?Math.min(...r[0].items):void 0):void 0}findRevenue(e){let t=[],r=e,s=0,n=!0,o=!1;for(;r&&!t.length&&s<5;){const e=window.getComputedStyle(r);if("none"===e.display||"line-through"===e.textDecoration)break;const i=r.textContent?.toLowerCase().trim()||"";if(i.length>350){this.log("MAX TEXT LENGTH EXCEEDED",i);break}if(i.length&&(t=this.parseRevenue(i)),t.length){this.log("RESULT NODE",r);break}let c;o?c=r.parentElement?.closest(this.selector):(c=r.nextElementSibling,o=!0),c||(n=!1,c=r.parentElement),r=c,s++}return{items:t,isSelectorMatched:n}}}class j extends b{constructor(){super([".js-submit-order-button"]),i(this,"id","webasyst-click")}}class Y extends E{constructor(){super([".wa-item-total .wa-price"]),i(this,"id","webasyst-click-parsed-revenue")}}class U extends b{constructor(){super([".wc-block-components-checkout-place-order-button",'[name="woocommerce_checkout_place_order"]',"#place_order"]),i(this,"id","woocommerce-click-selector-factor-collector")}}class G extends E{constructor(){super([".wc-block-components-totals-item__value",".order-total .woocommerce-Price-amount"]),i(this,"id","woocommerce-parsed-revenue-selector-data-collector")}}class H extends y{constructor(e){super(),this.conversionMarkupByCounter=e,i(this,"id","zero-code-checkout-click"),i(this,"maxSearchDepth",5)}applyFactor(e){const t=e.target;if(!(t instanceof HTMLElement))return!1;let r=t,s=0;for(;r&&s<this.maxSearchDepth;){const e=this.checkConversion(r);if(e)return{...e,internalData:{...e.internalData,convCheckoutDepth:s.toString(),...y.getNodeAttrsAndText(r)}};r=r.parentElement,s++}return!1}checkConversion(e){for(const t of Object.keys(this.conversionMarkupByCounter)){const r=(this.conversionMarkupByCounter[t].conversion_button??[]).find((([t,r])=>e.matches(r)));if(r)return{isMatched:!0,internalData:{counterIdConversion:t,algorithmConversion:r[0]}}}return!1}}const Z=1e3,V=e=>e.length>Z?e.slice(0,Z):e,W=new Set(["id","class","for","href","src","name","title","alt","role","type","aria-labelledby","aria-controls","aria-describedby","data-testid","data-test-id","data-qa"]),q=(e,t)=>{try{let s="";"id"===e&&t.length>0?(r=t,s=`#${CSS.escape(r)}`):s=((e,t)=>`[${e}='${CSS.escape(t)}']`)(e,t);const n=document.querySelectorAll(s).length;return[1===n,0===n]}catch{return[!1,!0]}var r},z=e=>t=>{if("function"!=typeof t.getAttributeNames)return{};let r=t.getAttributeNames();e&&(r=r.filter((t=>e.has(t)||t.startsWith("data-"))));return r.reduce(((e,r)=>{if(r.length>Z)return e;let s=t.getAttribute(r)||"";s=V(s);const[n,o]=q(r,s);return e[r]={value:s,isUnique:n},o&&(e[r].isBroken=!0),e}),{})},X=z(W),J=(z(),(e,t)=>{const r={};try{const s=X(e);return s&&Object.entries(s).forEach((([e,s])=>{r[`${t}-${e}`]=JSON.stringify(s,null,4)})),r}catch(e){v()?.sendError(e,"revenue"===t?c.Revenue:c.Factor,["ZERO_CODE_GET_CRITICAL_ATTRIBUTES"])}return r});class Q extends C{constructor(e){super(),this.conversionMarkupByCounter=e,i(this,"id","zero-code-revenue")}apply(e){for(const e of Object.keys(this.conversionMarkupByCounter)){const t=this.conversionMarkupByCounter[e].revenue_container;if(t)for(const[r,s]of t){const t=[...document.querySelectorAll(s)];if(t.length){const s=this.parsePrice(t);if(s){const t=J(s.matchedNode,"revenue");return{...s,internalData:{...s.internalData,algorithmRevenue:r,counterIdRevenue:e,...t}}}}}}}}let ee=function(e){return e.CreateOrderClick="create_order_click",e.CreateOrderClickCapture="create_order_click_capture",e.CreateOrderSubmit="create_order_submit",e.CreateOrderRequest="create_order_request",e.CreateOrderResponse="create_order_response",e.OrderThankYouPage="order_thank_you_page",e.CreateLeadClick="create_lead_click",e}({});const te="ecom-event";class re{constructor(e,t){this.target=e,this.transport=t}on(e,t){this.target.addEventListener(te,(r=>{try{e.includes(r.detail.eventKind)&&t(r.detail)}catch(e){this.transport?.sendError(e,c.EventsBus,[te,"ON_EVENT"])}}))}emit(e){try{this.target.dispatchEvent(new CustomEvent(te,{detail:e}))}catch(t){this.transport?.sendError(t,c.EventsBus,["EMIT",e.sourceId,e.eventKind])}}}let se;function ne(){const e=v();try{se||(se=new re(new EventTarget,e))}catch(t){e?.sendError(t,c.EventsBus,"CREATE_EVENTS_BUS")}return se}class oe{constructor(e){this.collectors=e,i(this,"id",void 0)}stop(){}processEvent(t){const r=v();if(r)try{Object.entries(this.collectors).forEach((([s,n])=>{let o=n.map((({factor:e,revenue:r,isZeroCodeCollector:s})=>{const n=this.applyCollector(t,e);if(!n)return;const o="boolean"==typeof n.res?{isMatched:n.res}:n.res;if(!o.isMatched)return;const i={factorId:e.id,revenue:o.revenue,revenueId:void 0!==o.revenue?e.id:void 0,internalData:{...o.internalData,factorPerf:n.perf.toFixed(2).toString(),observer:this.id},isZeroCodeCollector:s};if(void 0!==i.revenue||!r)return i;const c=this.applyCollector(t,r);if(!c?.res)return i;const a="object"==typeof c.res?c.res:{revenue:c.res};return{...i,revenue:a.revenue,revenueId:r.id,internalData:{...i.internalData,...a.internalData,revPerf:c.perf.toFixed(2).toString()}}})).filter(e);if(!o.length)return;const i=o.filter((e=>!!e.isZeroCodeCollector));o=o.filter((e=>!e.isZeroCodeCollector)),o.length&&r.sendData({[s]:o}),i.length&&r.sendZCData({[s]:i}),ne()?.emit({sourceId:this.id,eventKind:s,result:o})}))}catch(e){r.sendError(e,c.Observer,[this.id,"PROCESS_EVENT"])}}applyCollector(e,t){const r=v();if(r)try{const r=performance.now();return{res:t.apply(e),perf:performance.now()-r}}catch(e){r.sendError(e,t.scope,[this.id,t.id])}}}class ie extends oe{constructor(...e){super(...e),i(this,"id","base-click-observer"),i(this,"clickCb",void 0),i(this,"capture",!1)}start(){this.clickCb=e=>{this.processEvent(e)},window.document.addEventListener("click",this.clickCb,{capture:this.capture})}stop(){this.clickCb&&window.document.removeEventListener("click",this.clickCb,{capture:this.capture})}}class ce extends ie{constructor(...e){super(...e),i(this,"id","capture-click-observer"),i(this,"capture",!0)}}function ae(e,t=!1){return e.map((([e,r])=>({factor:e,revenue:r,isZeroCodeCollector:t})))}function le(){let e;try{e=s.getZeroCodeConversionMarkup()}catch(e){v()?.sendError(e,c.Global,["GET_ZERO_CODE_CONVERSION_MARKUP"])}return e?[[new H(e),new Q(e)]]:[]}function ue(e,t=!1){return{[e]:[...ae([[new k,new x],[new S,new _],[new T,new P],[new R,new L],[new O,new M],[new N,new I],[new D,new F],[new j,new Y],[new U,new G],[new $,new K]]),...t?ae(le(),!0):[]]}}class de extends y{parseEvent(e){if("https://ru-ibe.tlintegration.ru"!==e?.origin||!e?.data||"string"!=typeof e.data)return;const t=e.data.match(/\{.*}/)?.[0];if(!t)return;const{data:r}=JSON.parse(t);return"object"==typeof r&&"_method"in r?{method:r._method,action:r.action,event:r._event,revenue:"number"==typeof r.amount?r.amount:void 0,target:r.target}:void 0}}class he extends de{constructor(...e){super(...e),i(this,"id","universal-tl-collector"),i(this,"revenue",void 0)}applyFactor(e){const t=this.parseEvent(e);return!!t?.action&&("change-order-price"===t.action&&t.revenue?(this.revenue=t.revenue,!1):"click"===t.action&&"payment-pay-button"===t.target&&{isMatched:!0,revenue:this.revenue})}}class pe extends de{constructor(...e){super(...e),i(this,"id","universal-tl-typ-collector")}applyFactor(e){const t=this.parseEvent(e);return"bookingSuccess"===t?.event}}class me extends y{constructor(...e){super(...e),i(this,"id","universal-uhotels-collector"),i(this,"revenue",void 0)}applyFactor(e){if("https://api.uhotels.app"!==e.origin||!e?.data||!t(e.data))return!1;const r=e.data;return t(r.data)&&"priceNf"in r.data&&"number"==typeof r.data.priceNf&&(this.revenue=r.data.priceNf),"save-booking"===r.event&&{isMatched:!0,revenue:this.revenue}}}class fe extends oe{constructor(...e){super(...e),i(this,"id","message-observer"),i(this,"onMessageCb",void 0)}start(){this.onMessageCb=e=>{this.processEvent(e)},window.addEventListener("message",this.onMessageCb)}stop(){this.onMessageCb&&window.removeEventListener("message",this.onMessageCb)}}function ve(){return[[new he],[new me]]}let ge,we=function(e){return e.TYPEnabled="ea84",e}({});class ye{constructor(e,t){this.storage=e,this.transport=t}getKey(e){try{return this.storage.getItem(e)}catch(e){this.transport?.sendError(e,c.Storage,"GET_KEY")}return null}setKey(e,t){try{this.storage.setItem(e,t)}catch(e){this.transport?.sendError(e,c.Storage,"SET_KEY")}}}function be(){const e=v();try{ge||"function"!=typeof window.localStorage?.getItem||(ge=new ye(window.localStorage,e))}catch(t){e?.sendError(t,c.Storage,"CREATE_STORAGE")}return ge}const ke=/tilda|afisha/gu;class Ce{constructor(e,t){this.storage=e,this.eventBus=t,i(this,"reset",void 0),t.on([ee.CreateOrderClickCapture,ee.CreateOrderSubmit,ee.CreateOrderResponse,ee.OrderThankYouPage],this.onEcomEvent.bind(this))}isTypEnabled(){return!!ke.test(window.location.host)||"1"===this.storage.getKey(d(we.TYPEnabled))}onEcomEvent(e){const t=e.eventKind!==ee.OrderThankYouPage;this.reset&&(clearTimeout(this.reset),this.reset=void 0),t?this.storage.setKey(d(we.TYPEnabled),"1"):this.reset=setTimeout((()=>{this.storage.setKey(d(we.TYPEnabled),"0")}),500)}}let Ee;function xe(){const e=v();try{if(!Ee){const e=be(),t=ne();if(!e||!t)return;Ee=new Ce(e,t)}}catch(t){e?.sendError(t,c.Mutex,"CREATE_TYP_MUTEX")}return Ee}class Se extends y{constructor(){super(),i(this,"id","universal-thank-you-page-collector"),i(this,"titleKeywords",[/^(?:—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä–∏–º|—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏|–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å)\p{P}*$/gu]),i(this,"commonKeywords",[/(?:–∑–∞–∫–∞–∑|–±—Ä–æ–Ω—å|–æ–±—Ä–∞—â–µ–Ω–∏–µ|–∑–∞—è–≤–∫–∞|–ø–æ–∫—É–ø–∫–∞)(?:\s+\S+){0,3}\s+(?:—Å–æ–∑–¥–∞–Ω|–æ—Ñ–æ—Ä–º–ª–µ–Ω|–ø—Ä–∏–Ω—è—Ç|—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω|—Ä–∞–∑–º–µ—â–µ–Ω|–ø–æ–ª—É—á–µ–Ω|–æ–ø–ª–∞—á–µ–Ω|–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω|–æ–±—Ä–∞–±–æ—Ç–∞–Ω|–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è)[–∞–æ]?(?!\p{L})/gu,/(?<!\p{L})(?:—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä–∏–º|–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å|–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç)\p{P}*(?:\s+\S+){0,3}\s+(?:–∑–∞–∫–∞–∑|–ø–æ–∫—É–ø–∫—É|–∑–∞—è–≤–∫—É|–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ)(?!\p{L})/gu,/(?:–∑–≤–æ–Ω–∏—Ç|—Å–≤—è–∂–µ—Ç—Å—è)\s+(?:–æ–ø–µ—Ä–∞—Ç–æ—Ä|–º–µ–Ω–µ–¥–∂–µ—Ä)\s+(?:–∏ —Å–æ–≥–ª–∞—Å—É–µ—Ç –∑–∞–∫–∞–∑|–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)/gu,/(^—Å–∫–∞—á–∞—Ç—å –±–∏–ª–µ—Ç—ã?$)|(^—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç$)/gu]),i(this,"urlKeywords",[/thank|spasibo|success|(?:^|\/)uspeh(?:$|\/)/gu,/(?:order|basket|checkout).*complete/gu,/complete.*(?:order|basket|checkout)/gu]),i(this,"blockPhraseInPath",[/auth|regist|signup|unsuccess|subscribe|letter|remind|webinar|login|pass|anketa|(?<!\p{L})faq(?!\p{L})|otz[iy]v[iy]|help|dostavka|delivery|uslovia|terms|success[_-]?story|instruktsiya|contact/gu]),i(this,"contentPatterns",{keywords:this.commonKeywords,stopPhrases:{inMatched:[/–±—É–¥–µ—Ç|–º–æ–∂–Ω–æ|–º–æ–∂–µ—Ç|–±—ã—Ç—å|–¥–æ–ª–∂–µ–Ω|(?<!\p{L})–Ω–µ(?!\p{L})/gu],before:[/(?<!\p{L})(?:—á—Ç–æ–±—ã|—á—Ç–æ|–µ—Å–ª–∏|–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)(?!\p{L})/gu],after:[/(?<!\p{L})(?:–¥–æ|–ø–æ—Å–ª–µ)(?!\p{L})/gu],contextLength:60}}),i(this,"typSelector",'[class*="message_ok"]'),i(this,"feedbackSelector",'[class*="message"], [class*="comment"], [class*="review"], [class*="feedback"], [class*="answer"], [class*="Review"], [class*="Fake"]'),i(this,"mutex",void 0),this.mutex=xe()}applyFactor(e){let t,r="title";const s=document.title.toLowerCase().trim(),n=this.getRelUrl(),o=window.location.pathname.toLowerCase(),i={};if(this.matchSome(o,{keywords:this.blockPhraseInPath}))return!1;if(t=this.matchSome(s,{keywords:[...this.titleKeywords,...this.commonKeywords]}),t||(t=this.matchSome(n,{keywords:this.urlKeywords}),r="url"),!t&&this.mutex&&!this.mutex.isTypEnabled())return this.log("TYP is disabled"),!1;if(!t){const e=this.matchContent();e?.length&&(t={phrase:e[0].phrase,phraseContext:e[0].phraseContext},i.matchedClasses=e[0].classNames.join(","),i.matchedIds=e[0].ids.join(",")),r="content"}return!!t&&{isMatched:!0,internalData:{target:r,fullPath:n,title:s,...t,...i,version:"8"}}}matchContent(){let e=this.findElementsByPatterns(this.contentPatterns);if(e=e.filter((({node:e})=>!(!e.closest(this.typSelector)&&e.closest(this.feedbackSelector))&&this.checkVisibility(e))),e.length)return e.map((e=>({...e.match,...this.collectAttrs(e.node)})))}getRelUrl(){const e=window.location,t=new URLSearchParams([...new URLSearchParams(e.search).entries()].filter((([e])=>!e.toLowerCase().includes("utm")))).toString();return`${e.pathname}${t}${e.hash}`.toLowerCase()}}class _e extends oe{constructor(...e){super(...e),i(this,"id","page-hide-observer"),i(this,"callback",void 0)}start(){this.callback=()=>{document.body&&this.processEvent(void 0)},window.addEventListener("visibilitychange",this.callback)}stop(){this.callback&&window.removeEventListener("visibilitychange",this.callback)}}class Te extends y{constructor(e){super(),this.views=e,i(this,"isPageReloaded",void 0),this.isPageReloaded=window.performance.navigation&&1===window.performance.navigation.type||window.performance.getEntriesByType("navigation").some((e=>"type"in e&&"reload"===e.type))}applyFactor(){return this.views.some((({url:e,referrer:t})=>{const r=!e||("string"==typeof e?document.location.href.includes(e):e.test(document.location.href)),s=this.isPageReloaded?"":document.referrer,n=!t||("string"==typeof t?s.includes(t):t.test(s));return r&&n}))}}class Pe extends Te{constructor(){super([{url:"/order/?ORDER_ID=",referrer:"/order/"}]),i(this,"id","1c-bitrix-page-view")}}class Re extends Te{constructor(){super([{url:"index.php?dispatch=checkout.complete",referrer:"index.php?dispatch=checkout.checkout"}]),i(this,"id","cs-cart-page-view")}}class Le extends Te{constructor(){super([{url:"/orders/",referrer:/\/new_order$/}]),i(this,"id","insales-page-view")}}class Oe extends E{constructor(){super([".co-price"]),i(this,"id","insales-page-view-parsed-revenue")}}class Me extends Te{constructor(){super([{url:"checkout/finish",referrer:"checkout"},{url:"/finish",referrer:/\/step\d/}]),i(this,"id","joomla-page-view")}}class Ne extends Te{constructor(){super([{url:"/index.php?route=checkout/success"},{url:"/order-success/"}]),i(this,"id","opencart-page-view")}}class Ie extends Te{constructor(){super([{url:"/checkout/success",referrer:"/order"}]),i(this,"id","webasyst-page-view")}}class De extends oe{constructor(...e){super(...e),i(this,"id","page-view-observer"),i(this,"urlWatchTimeout",void 0),i(this,"currentUrl",void 0)}start(){this.urlWatchTimeout=setInterval((()=>{this.checkUrl()}),100),this.checkUrl()}stop(){this.urlWatchTimeout&&clearTimeout(this.urlWatchTimeout)}checkUrl(){try{location.href!==this.currentUrl&&document.body&&(this.currentUrl=location.href,this.processEvent(void 0))}catch(e){v()?.sendError(e,c.Observer,"URL_WATCH")}}}const Ae=v();try{Ae?.log("START ECOM COLLECTOR"),[new ie({...ue(ee.CreateOrderClick,!0)}),new ce({...ue(ee.CreateOrderClickCapture),[ee.CreateLeadClick]:ae([[new B]])}),new De({[ee.OrderThankYouPage]:ae([[new Le,new Oe],[new Ne],[new Me],[new Ie],[new Re],[new Pe],[new Se]])}),new _e({[ee.OrderThankYouPage]:ae([[new Se]])}),new fe({[ee.CreateOrderClickCapture]:ae(ve()),[ee.CreateOrderClick]:ae(ve()),[ee.OrderThankYouPage]:ae([[new pe],[new me]])})].forEach((e=>e.start()))}catch(e){Ae?.sendError(e,c.Global,"INIT")}})();